<!--ç®¡ç†åå° - äº§å“æ•°æ®ç®¡ç†é¡µé¢-->
<view class="container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="header">
    <view class="header-title">ç®¡ç†åå°</view>
    <view class="header-subtitle">{{currentTab === 'products' ? 'å…± ' + totalCount + ' ä¸ªäº§å“' : 'å…± ' + requestsCount + ' ä¸ªå‚¬æ›´è¯·æ±‚'}}</view>
  </view>

  <!-- æ ‡ç­¾é¡µåˆ‡æ¢ -->
  <view class="tab-bar">
    <view class="tab-item {{currentTab === 'products' ? 'active' : ''}}" bindtap="switchTab" data-tab="products">
      <view class="tab-icon">ğŸ“¦</view>
      <view class="tab-text">äº§å“ç®¡ç†</view>
    </view>
    <view class="tab-item {{currentTab === 'requests' ? 'active' : ''}}" bindtap="switchTab" data-tab="requests">
      <view class="tab-icon">ğŸ“</view>
      <view class="tab-text">å‚¬æ›´è¯·æ±‚</view>
      <view wx:if="{{pendingRequestsCount > 0}}" class="tab-badge">{{pendingRequestsCount}}</view>
    </view>
  </view>

  <!-- äº§å“ç®¡ç†å†…å®¹ -->
  <view wx:if="{{currentTab === 'products'}}" class="products-content">
    <!-- ç»Ÿè®¡å¡ç‰‡ -->
    <view class="statistics-cards">
    <view class="stat-card">
      <view class="stat-number">{{statistics.totalProducts}}</view>
      <view class="stat-label">æ€»äº§å“æ•°</view>
    </view>
    <view class="stat-card">
      <view class="stat-number">{{statistics.activeProducts}}</view>
      <view class="stat-label">å·²å¯ç”¨</view>
    </view>
    <view class="stat-card">
      <view class="stat-number">{{statistics.inactiveProducts}}</view>
      <view class="stat-label">å·²ç¦ç”¨</view>
    </view>
    <view class="stat-card">
      <view class="stat-number">{{statistics.totalBrands}}</view>
      <view class="stat-label">å“ç‰Œæ•°</view>
    </view>
  </view>

  <!-- æœç´¢å’Œç­›é€‰ -->
  <view class="search-filter-section">
    <!-- æœç´¢æ¡† -->
    <view class="search-box">
      <view class="search-icon">ğŸ”</view>
      <input class="search-input" 
             value="{{searchText}}" 
             placeholder="æœç´¢äº§å“åç§°æˆ–å“ç‰Œ"
             bindinput="onSearchInput" />
      <view wx:if="{{searchText}}" class="clear-search" bindtap="clearFilters">Ã—</view>
    </view>

    <!-- ç­›é€‰å™¨ -->
    <view class="filter-row">
      <picker class="filter-picker" 
              range="{{['å…¨éƒ¨'].concat(categories)}}" 
              value="{{filterCategory ? categories.indexOf(filterCategory) + 1 : 0}}"
              bindchange="onCategoryChange">
        <view class="filter-display">
          <view class="filter-text">{{filterCategory || 'å…¨éƒ¨åˆ†ç±»'}}</view>
          <view class="filter-arrow">â–¼</view>
        </view>
      </picker>

      <picker class="filter-picker" 
              range="{{brandOptions}}" 
              value="{{filterBrandIndex}}"
              bindchange="onBrandChange">
        <view class="filter-display">
          <view class="filter-text">{{filterBrand || 'å…¨éƒ¨å“ç‰Œ'}}</view>
          <view class="filter-arrow">â–¼</view>
        </view>
      </picker>

      <picker class="filter-picker" 
              range="{{['å…¨éƒ¨', 'å·²å¯ç”¨', 'å·²ç¦ç”¨']}}" 
              range-key="label"
              value="{{filterStatus === 'all' ? 0 : (filterStatus === 'active' ? 1 : 2)}}"
              bindchange="onStatusChange">
        <view class="filter-display">
          <view class="filter-text">
            {{filterStatus === 'all' ? 'å…¨éƒ¨çŠ¶æ€' : (filterStatus === 'active' ? 'å·²å¯ç”¨' : 'å·²ç¦ç”¨')}}
          </view>
          <view class="filter-arrow">â–¼</view>
        </view>
      </picker>
    </view>
  </view>

  <!-- æ“ä½œæ  -->
  <view class="action-bar">
    <view class="left-actions">
      <button class="action-btn primary" bindtap="goToUpload">
        <view class="btn-icon">â•</view>
        <view class="btn-text">æ·»åŠ äº§å“</view>
      </button>
      <button class="action-btn {{isSelectMode ? 'active' : ''}}" bindtap="toggleSelectMode">
        <view class="btn-icon">{{isSelectMode ? 'âœ“' : 'â˜'}}</view>
        <view class="btn-text">{{isSelectMode ? 'å–æ¶ˆé€‰æ‹©' : 'æ‰¹é‡æ“ä½œ'}}</view>
      </button>
      <button class="action-btn test" bindtap="showCloudFunctionTest">
        <view class="btn-icon">ğŸ§ª</view>
        <view class="btn-text">æµ‹è¯•äº‘å‡½æ•°</view>
      </button>
    </view>
    
    <view class="right-actions">
      <button class="action-btn" bindtap="exportData">
        <view class="btn-icon">ğŸ“¤</view>
        <view class="btn-text">å¯¼å‡º</view>
      </button>
    </view>
  </view>

  <!-- æ‰¹é‡æ“ä½œæ  -->
  <view wx:if="{{isSelectMode && selectedProducts.length > 0}}" class="batch-action-bar">
    <view class="selected-count">å·²é€‰æ‹© {{selectedProducts.length}} ä¸ªäº§å“</view>
    <view class="batch-actions">
      <button class="batch-btn" bindtap="showBatchActions">æ‰¹é‡æ“ä½œ</button>
      <button class="batch-btn" bindtap="toggleSelectAll">
        {{selectedProducts.length === filteredProducts.length ? 'å–æ¶ˆå…¨é€‰' : 'å…¨é€‰'}}
      </button>
    </view>
  </view>

  <!-- äº§å“åˆ—è¡¨ -->
  <view class="product-list">
    <view wx:if="{{listLoading && filteredProducts.length === 0}}" class="loading-state">
      <view class="loading-icon">â³</view>
      <view class="loading-text">åŠ è½½ä¸­...</view>
    </view>

    <view wx:elif="{{filteredProducts.length === 0}}" class="empty-state">
      <view class="empty-icon">ğŸ“¦</view>
      <view class="empty-text">æš‚æ— äº§å“æ•°æ®</view>
      <button class="empty-action" bindtap="goToUpload">æ·»åŠ ç¬¬ä¸€ä¸ªäº§å“</button>
    </view>

    <view wx:else>
      <view wx:for="{{filteredProducts}}" 
            wx:key="id" 
            class="product-item {{isSelectMode ? 'select-mode' : ''}}"
            bindtap="{{isSelectMode ? 'toggleProductSelect' : 'viewProductDetail'}}"
            data-id="{{item.id}}">
        
        <!-- é€‰æ‹©æ¡† -->
        <view wx:if="{{isSelectMode}}" class="select-checkbox">
          <view class="checkbox {{selectedProducts.includes(item.id) ? 'checked' : ''}}">
            {{selectedProducts.includes(item.id) ? 'âœ“' : ''}}
          </view>
        </view>

        <!-- äº§å“å›¾ç‰‡ -->
        <view class="product-image">
          <image src="{{item.image}}" mode="aspectFill" />
          <view class="status-badge {{item.status}}">
            {{item.status === 'active' ? 'å¯ç”¨' : 'ç¦ç”¨'}}
          </view>
        </view>

        <!-- äº§å“ä¿¡æ¯ -->
        <view class="product-info">
          <view class="product-name">{{item.name}}</view>
          <view class="product-brand">{{item.brand}}</view>
          <view class="product-category">{{item.category}}</view>
          <view class="product-price">Â¥{{item.price}}</view>
          
          <view class="product-meta">
            <view class="meta-item">
              <view class="meta-label">é”€é‡:</view>
              <view class="meta-value">{{item.sales}}</view>
            </view>
            <view class="meta-item">
              <view class="meta-label">è¯„åˆ†:</view>
              <view class="meta-value">{{item.rating}}</view>
            </view>
            <view class="meta-item">
              <view class="meta-label">æ›´æ–°:</view>
              <view class="meta-value">{{item.updateTime.split('T')[0]}}</view>
            </view>
          </view>
        </view>

        <!-- æ“ä½œæŒ‰é’® -->
        <view wx:if="{{!isSelectMode}}" class="product-actions">
          <button class="action-icon edit" 
                  bindtap="editProduct" 
                  data-id="{{item.id}}"
                  catchtap="true">
            âœï¸
          </button>
          <button class="action-icon toggle" 
                  bindtap="toggleProductStatus" 
                  data-id="{{item.id}}"
                  catchtap="true">
            {{item.status === 'active' ? 'ğŸ”’' : 'ğŸ”“'}}
          </button>
          <button class="action-icon delete" 
                  bindtap="deleteProduct" 
                  data-id="{{item.id}}"
                  catchtap="true">
            ğŸ—‘ï¸
          </button>
        </view>
      </view>
    </view>
  </view>

  <!-- åŠ è½½æ›´å¤š -->
  <view wx:if="{{hasMore && !listLoading}}" class="load-more">
    <button class="load-more-btn" bindtap="loadMoreProducts">åŠ è½½æ›´å¤š</button>
  </view>

  <view wx:if="{{listLoading && filteredProducts.length > 0}}" class="loading-more">
    <view class="loading-text">åŠ è½½ä¸­...</view>
  </view>
  </view>

  <!-- å‚¬æ›´è¯·æ±‚ç®¡ç†å†…å®¹ -->
  <view wx:if="{{currentTab === 'requests'}}" class="requests-content">
    <!-- è¯·æ±‚ç»Ÿè®¡å¡ç‰‡ -->
    <view class="statistics-cards">
      <view class="stat-card">
        <view class="stat-number">{{requestsStatistics.totalRequests}}</view>
        <view class="stat-label">æ€»è¯·æ±‚æ•°</view>
      </view>
      <view class="stat-card">
        <view class="stat-number">{{requestsStatistics.pendingRequests}}</view>
        <view class="stat-label">å¾…å¤„ç†</view>
      </view>
      <view class="stat-card">
        <view class="stat-number">{{requestsStatistics.approvedRequests}}</view>
        <view class="stat-label">å·²é€šè¿‡</view>
      </view>
      <view class="stat-card">
        <view class="stat-number">{{requestsStatistics.rejectedRequests}}</view>
        <view class="stat-label">å·²æ‹’ç»</view>
      </view>
    </view>

    <!-- è¯·æ±‚ç­›é€‰ -->
    <view class="search-filter-section">
      <view class="search-box">
        <view class="search-icon">ğŸ”</view>
        <input class="search-input" 
               value="{{requestSearchText}}" 
               placeholder="æœç´¢äº§å“åç§°æˆ–ç”¨æˆ·"
               bindinput="onRequestSearchInput" />
        <view wx:if="{{requestSearchText}}" class="clear-search" bindtap="clearRequestFilters">Ã—</view>
      </view>

      <view class="filter-row">
        <picker class="filter-picker" 
                range="{{['å…¨éƒ¨çŠ¶æ€', 'å¾…å¤„ç†', 'å·²é€šè¿‡', 'å·²æ‹’ç»']}}" 
                value="{{requestFilterStatus === 'all' ? 0 : (requestFilterStatus === 'pending' ? 1 : (requestFilterStatus === 'approved' ? 2 : 3))}}"
                bindchange="onRequestStatusChange">
          <view class="filter-display">
            <view class="filter-text">
              {{requestFilterStatus === 'all' ? 'å…¨éƒ¨çŠ¶æ€' : (requestFilterStatus === 'pending' ? 'å¾…å¤„ç†' : (requestFilterStatus === 'approved' ? 'å·²é€šè¿‡' : 'å·²æ‹’ç»'))}}
            </view>
            <view class="filter-arrow">â–¼</view>
          </view>
        </picker>

        <picker class="filter-picker" 
                range="{{['å…¨éƒ¨åˆ†ç±»'].concat(categories)}}" 
                value="{{requestFilterCategory ? categories.indexOf(requestFilterCategory) + 1 : 0}}"
                bindchange="onRequestCategoryChange">
          <view class="filter-display">
            <view class="filter-text">{{requestFilterCategory || 'å…¨éƒ¨åˆ†ç±»'}}</view>
            <view class="filter-arrow">â–¼</view>
          </view>
        </picker>
      </view>
    </view>

    <!-- è¯·æ±‚åˆ—è¡¨ -->
    <view class="request-list">
      <view wx:if="{{requestsLoading && filteredRequests.length === 0}}" class="loading-state">
        <view class="loading-icon">â³</view>
        <view class="loading-text">åŠ è½½ä¸­...</view>
      </view>

      <view wx:elif="{{filteredRequests.length === 0}}" class="empty-state">
        <view class="empty-icon">ğŸ“</view>
        <view class="empty-text">æš‚æ— å‚¬æ›´è¯·æ±‚</view>
      </view>

      <view wx:else>
        <view wx:for="{{filteredRequests}}" 
              wx:key="id" 
              class="request-item"
              bindtap="viewRequestDetail"
              data-id="{{item.id}}">
          
          <!-- è¯·æ±‚çŠ¶æ€æ ‡è¯† -->
          <view class="request-status {{item.status}}">
            <view class="status-dot"></view>
            <view class="status-text">
              {{item.status === 'pending' ? 'å¾…å¤„ç†' : (item.status === 'approved' ? 'å·²é€šè¿‡' : 'å·²æ‹’ç»')}}
            </view>
          </view>

          <!-- è¯·æ±‚ä¿¡æ¯ -->
          <view class="request-info">
            <view class="request-header">
              <view class="product-name">{{item.productName}}</view>
              <view class="request-time">{{item.createTime.split('T')[0]}}</view>
            </view>
            
            <view class="request-details">
              <view class="detail-row">
                <view class="detail-label">å“ç‰Œ:</view>
                <view class="detail-value">{{item.brand}}</view>
              </view>
              <view class="detail-row">
                <view class="detail-label">åˆ†ç±»:</view>
                <view class="detail-value">{{item.category}}</view>
              </view>
              <view class="detail-row">
                <view class="detail-label">ç”¨æˆ·:</view>
                <view class="detail-value">{{item.userNickname || item.userId}}</view>
              </view>
            </view>

            <view wx:if="{{item.description}}" class="request-description">
              {{item.description}}
            </view>

            <view wx:if="{{item.images && item.images.length > 0}}" class="request-images">
              <view wx:for="{{item.images}}" wx:key="*this" wx:for-item="image" class="image-thumb">
                <image src="{{image}}" mode="aspectFill" />
              </view>
            </view>
          </view>

          <!-- æ“ä½œæŒ‰é’® -->
          <view wx:if="{{item.status === 'pending'}}" class="request-actions">
            <button class="action-btn approve" 
                    bindtap="approveRequest" 
                    data-id="{{item.id}}"
                    catchtap="true">
              âœ… é€šè¿‡
            </button>
            <button class="action-btn reject" 
                    bindtap="rejectRequest" 
                    data-id="{{item.id}}"
                    catchtap="true">
              âŒ æ‹’ç»
            </button>
          </view>

          <!-- å¤„ç†ç»“æœ -->
          <view wx:if="{{item.status !== 'pending' && item.adminFeedback}}" class="admin-feedback">
            <view class="feedback-label">ç®¡ç†å‘˜åé¦ˆ:</view>
            <view class="feedback-content">{{item.adminFeedback}}</view>
          </view>
        </view>
      </view>
    </view>

    <!-- åŠ è½½æ›´å¤šè¯·æ±‚ -->
    <view wx:if="{{hasMoreRequests && !requestsLoading}}" class="load-more">
      <button class="load-more-btn" bindtap="loadMoreRequests">åŠ è½½æ›´å¤š</button>
    </view>

    <view wx:if="{{requestsLoading && filteredRequests.length > 0}}" class="loading-more">
      <view class="loading-text">åŠ è½½ä¸­...</view>
    </view>
  </view>
</view>

<!-- è¯·æ±‚è¯¦æƒ…å¼¹çª— -->
<view wx:if="{{showRequestDetail}}" class="request-detail-modal">
  <view class="modal-mask" bindtap="closeRequestDetail"></view>
  <view class="detail-content">
    <view class="detail-header">
      <view class="detail-title">å‚¬æ›´è¯·æ±‚è¯¦æƒ…</view>
      <view class="detail-close" bindtap="closeRequestDetail">Ã—</view>
    </view>
    
    <scroll-view class="detail-body" scroll-y>
      <view wx:if="{{currentRequest}}" class="request-detail">
        <view class="detail-section">
          <view class="section-title">åŸºæœ¬ä¿¡æ¯</view>
          <view class="detail-row">
            <view class="detail-label">äº§å“åç§°:</view>
            <view class="detail-value">{{currentRequest.productName}}</view>
          </view>
          <view class="detail-row">
            <view class="detail-label">å“ç‰Œ:</view>
            <view class="detail-value">{{currentRequest.brand}}</view>
          </view>
          <view class="detail-row">
            <view class="detail-label">åˆ†ç±»:</view>
            <view class="detail-value">{{currentRequest.category}}</view>
          </view>
          <view class="detail-row">
            <view class="detail-label">çŠ¶æ€:</view>
            <view class="detail-value {{currentRequest.status}}">
              {{currentRequest.status === 'pending' ? 'å¾…å¤„ç†' : (currentRequest.status === 'approved' ? 'å·²é€šè¿‡' : 'å·²æ‹’ç»')}}
            </view>
          </view>
        </view>

        <view class="detail-section">
          <view class="section-title">ç”¨æˆ·ä¿¡æ¯</view>
          <view class="detail-row">
            <view class="detail-label">ç”¨æˆ·æ˜µç§°:</view>
            <view class="detail-value">{{currentRequest.userNickname || 'æœªè®¾ç½®'}}</view>
          </view>
          <view class="detail-row">
            <view class="detail-label">è”ç³»æ–¹å¼:</view>
            <view class="detail-value">{{currentRequest.contactInfo || 'æœªæä¾›'}}</view>
          </view>
        </view>

        <view wx:if="{{currentRequest.description}}" class="detail-section">
          <view class="section-title">äº§å“æè¿°</view>
          <view class="description-content">{{currentRequest.description}}</view>
        </view>

        <view wx:if="{{currentRequest.notes}}" class="detail-section">
          <view class="section-title">å¤‡æ³¨ä¿¡æ¯</view>
          <view class="notes-content">{{currentRequest.notes}}</view>
        </view>

        <view wx:if="{{currentRequest.images && currentRequest.images.length > 0}}" class="detail-section">
          <view class="section-title">äº§å“å›¾ç‰‡</view>
          <view class="images-grid">
            <view wx:for="{{currentRequest.images}}" wx:key="*this" wx:for-item="image" class="image-item">
              <image src="{{image}}" mode="aspectFill" bindtap="previewImage" data-url="{{image}}" />
            </view>
          </view>
        </view>

        <view class="detail-section">
          <view class="section-title">æ—¶é—´ä¿¡æ¯</view>
          <view class="detail-row">
            <view class="detail-label">æäº¤æ—¶é—´:</view>
            <view class="detail-value">{{currentRequest.createTime}}</view>
          </view>
          <view wx:if="{{currentRequest.processTime}}" class="detail-row">
            <view class="detail-label">å¤„ç†æ—¶é—´:</view>
            <view class="detail-value">{{currentRequest.processTime}}</view>
          </view>
        </view>

        <view wx:if="{{currentRequest.adminFeedback}}" class="detail-section">
          <view class="section-title">ç®¡ç†å‘˜åé¦ˆ</view>
          <view class="feedback-content">{{currentRequest.adminFeedback}}</view>
        </view>
      </view>
    </scroll-view>
    
    <view wx:if="{{currentRequest && currentRequest.status === 'pending'}}" class="detail-actions">
      <button class="detail-btn approve" bindtap="showProcessModal" data-action="approve">é€šè¿‡è¯·æ±‚</button>
      <button class="detail-btn reject" bindtap="showProcessModal" data-action="reject">æ‹’ç»è¯·æ±‚</button>
    </view>
  </view>
</view>

<!-- å¤„ç†è¯·æ±‚å¼¹çª— -->
<view wx:if="{{showProcessModal}}" class="process-modal">
  <view class="modal-mask" bindtap="hideProcessModal"></view>
  <view class="process-content">
    <view class="process-header">
      <view class="process-title">
        {{processAction === 'approve' ? 'é€šè¿‡è¯·æ±‚' : 'æ‹’ç»è¯·æ±‚'}}
      </view>
    </view>
    
    <view class="process-body">
      <view class="process-info">
        <view class="info-row">
          <view class="info-label">äº§å“åç§°:</view>
          <view class="info-value">{{currentRequest.productName}}</view>
        </view>
        <view class="info-row">
          <view class="info-label">ç”¨æˆ·:</view>
          <view class="info-value">{{currentRequest.userNickname || currentRequest.userId}}</view>
        </view>
      </view>

      <view class="feedback-section">
        <view class="feedback-label">ç®¡ç†å‘˜åé¦ˆ (å¯é€‰)</view>
        <textarea class="feedback-textarea" 
                  value="{{processFeedback}}" 
                  placeholder="{{processAction === 'approve' ? 'è¯·è¾“å…¥é€šè¿‡ç†ç”±æˆ–è¡¥å……è¯´æ˜...' : 'è¯·è¾“å…¥æ‹’ç»ç†ç”±...'}}"
                  bindinput="onProcessFeedbackInput" />
      </view>
    </view>
    
    <view class="process-actions">
      <button class="process-btn cancel" bindtap="hideProcessModal">å–æ¶ˆ</button>
      <button class="process-btn confirm {{processAction}}" 
              bindtap="confirmProcessRequest"
              disabled="{{processLoading}}">
        <view wx:if="{{processLoading}}" class="loading-icon">â³</view>
        <view class="btn-text">
          {{processLoading ? 'å¤„ç†ä¸­...' : (processAction === 'approve' ? 'ç¡®è®¤é€šè¿‡' : 'ç¡®è®¤æ‹’ç»')}}
        </view>
      </button>
    </view>
  </view>
</view>

<!-- äº§å“è¯¦æƒ…å¼¹çª— -->
<view wx:if="{{showProductDetail}}" class="product-detail-modal">
  <view class="modal-mask" bindtap="closeProductDetail"></view>
  <view class="detail-content">
    <view class="detail-header">
      <view class="detail-title">äº§å“è¯¦æƒ…</view>
      <view class="detail-close" bindtap="closeProductDetail">Ã—</view>
    </view>
    
    <scroll-view class="detail-body" scroll-y>
      <view wx:if="{{currentProduct}}" class="product-detail">
        <view class="detail-image">
          <image src="{{currentProduct.image}}" mode="aspectFill" />
        </view>
        
        <view class="detail-info">
          <view class="detail-row">
            <view class="detail-label">äº§å“åç§°:</view>
            <view class="detail-value">{{currentProduct.name}}</view>
          </view>
          <view class="detail-row">
            <view class="detail-label">å“ç‰Œ:</view>
            <view class="detail-value">{{currentProduct.brand}}</view>
          </view>
          <view class="detail-row">
            <view class="detail-label">åˆ†ç±»:</view>
            <view class="detail-value">{{currentProduct.category}}</view>
          </view>
          <view class="detail-row">
            <view class="detail-label">ä»·æ ¼:</view>
            <view class="detail-value">Â¥{{currentProduct.price}}</view>
          </view>
          <view class="detail-row">
            <view class="detail-label">çŠ¶æ€:</view>
            <view class="detail-value {{currentProduct.status}}">
              {{currentProduct.status === 'active' ? 'å·²å¯ç”¨' : 'å·²ç¦ç”¨'}}
            </view>
          </view>
          <view class="detail-row">
            <view class="detail-label">é”€é‡:</view>
            <view class="detail-value">{{currentProduct.sales}}</view>
          </view>
          <view class="detail-row">
            <view class="detail-label">è¯„åˆ†:</view>
            <view class="detail-value">{{currentProduct.rating}}</view>
          </view>
          <view class="detail-row">
            <view class="detail-label">åˆ›å»ºæ—¶é—´:</view>
            <view class="detail-value">{{currentProduct.createTime.split('T')[0]}}</view>
          </view>
          <view class="detail-row">
            <view class="detail-label">æ›´æ–°æ—¶é—´:</view>
            <view class="detail-value">{{currentProduct.updateTime.split('T')[0]}}</view>
          </view>
        </view>
      </view>
    </scroll-view>
    
    <view class="detail-actions">
      <button class="detail-btn edit" bindtap="editProduct" data-id="{{currentProduct.id}}">ç¼–è¾‘</button>
      <button class="detail-btn toggle" bindtap="toggleProductStatus" data-id="{{currentProduct.id}}">
        {{currentProduct.status === 'active' ? 'ç¦ç”¨' : 'å¯ç”¨'}}
      </button>
    </view>
  </view>
</view>

<!-- æ‰¹é‡æ“ä½œå¼¹çª— -->
<view wx:if="{{showBatchActions}}" class="batch-actions-modal">
  <view class="modal-mask" bindtap="hideBatchActions"></view>
  <view class="batch-content">
    <view class="batch-header">
      <view class="batch-title">æ‰¹é‡æ“ä½œ</view>
      <view class="batch-subtitle">å·²é€‰æ‹© {{selectedProducts.length}} ä¸ªäº§å“</view>
    </view>
    
    <view class="batch-options">
      <button class="batch-option enable" bindtap="batchEnable">
        <view class="option-icon">ğŸ”“</view>
        <view class="option-text">æ‰¹é‡å¯ç”¨</view>
      </button>
      <button class="batch-option disable" bindtap="batchDisable">
        <view class="option-icon">ğŸ”’</view>
        <view class="option-text">æ‰¹é‡ç¦ç”¨</view>
      </button>
      <button class="batch-option delete" bindtap="batchDelete">
        <view class="option-icon">ğŸ—‘ï¸</view>
        <view class="option-text">æ‰¹é‡åˆ é™¤</view>
      </button>
    </view>
    
    <button class="batch-cancel" bindtap="hideBatchActions">å–æ¶ˆ</button>
  </view>
</view>

<!-- äº‘å‡½æ•°æµ‹è¯•å¼¹çª— -->
<view wx:if="{{showCloudFunctionTest}}" class="cloud-test-modal">
  <view class="modal-mask" bindtap="hideCloudFunctionTest"></view>
  <view class="test-content">
    <view class="test-header">
      <view class="test-title">äº‘å‡½æ•°æµ‹è¯•</view>
      <view class="test-close" bindtap="hideCloudFunctionTest">Ã—</view>
    </view>
    
    <view class="test-body">
      <!-- äº‘å‡½æ•°é€‰æ‹© -->
      <view class="test-section">
        <view class="section-title">é€‰æ‹©äº‘å‡½æ•°</view>
        <picker class="function-picker" 
                range="{{cloudFunctions}}" 
                range-key="name"
                value="{{selectedFunctionIndex}}"
                bindchange="onCloudFunctionChange">
          <view class="picker-display">
            <view class="picker-text">
              {{selectedCloudFunction ? selectedCloudFunction.name : 'è¯·é€‰æ‹©äº‘å‡½æ•°'}}
            </view>
            <view class="picker-arrow">â–¼</view>
          </view>
        </picker>
        
        <view wx:if="{{selectedCloudFunction}}" class="function-info">
          <view class="info-item">
            <view class="info-label">åŠŸèƒ½æè¿°:</view>
            <view class="info-value">{{selectedCloudFunction.description}}</view>
          </view>
          <view class="info-item">
            <view class="info-label">APIè·¯å¾„:</view>
            <view class="info-value">{{selectedCloudFunction.apiPath}}</view>
          </view>
        </view>
      </view>
      
      <!-- æµ‹è¯•å‚æ•° -->
      <view wx:if="{{selectedCloudFunction}}" class="test-section">
        <view class="section-title">æµ‹è¯•å‚æ•°</view>
        <textarea class="param-textarea" 
                  value="{{testParams}}" 
                  placeholder="è¯·è¾“å…¥JSONæ ¼å¼çš„æµ‹è¯•å‚æ•°"
                  bindinput="onTestParamsInput" />
      </view>
      
      <!-- æµ‹è¯•æŒ‰é’® -->
      <view class="test-actions">
        <button class="test-btn primary {{testLoading ? 'loading' : ''}}" 
                bindtap="startCloudFunctionTest"
                disabled="{{!selectedCloudFunction || testLoading}}">
          <view wx:if="{{testLoading}}" class="loading-icon">â³</view>
          <view class="btn-text">{{testLoading ? 'æµ‹è¯•ä¸­...' : 'å¼€å§‹æµ‹è¯•'}}</view>
        </button>
        <button class="test-btn" bindtap="clearTestResult">æ¸…ç©ºç»“æœ</button>
      </view>
      
      <!-- æµ‹è¯•ç»“æœ -->
      <view wx:if="{{testResult}}" class="test-result">
        <view class="result-header">
          <view class="result-title">æµ‹è¯•ç»“æœ</view>
          <view class="result-status {{testResult.success ? 'success' : 'error'}}">
            {{testResult.success ? 'âœ… æˆåŠŸ' : 'âŒ å¤±è´¥'}}
          </view>
        </view>
        
        <view class="result-content">
          <view class="result-item">
            <view class="result-label">å“åº”æ—¶é—´:</view>
            <view class="result-value">{{testResult.duration}}ms</view>
          </view>
          <view class="result-item">
            <view class="result-label">çŠ¶æ€ç :</view>
            <view class="result-value">{{testResult.code}}</view>
          </view>
          
          <view class="result-data">
            <view class="data-title">è¿”å›æ•°æ®:</view>
            <scroll-view class="data-content" scroll-y>
              <text class="data-text">{{testResult.dataText}}</text>
            </scroll-view>
          </view>
          
          <view wx:if="{{testResult.error}}" class="result-error">
            <view class="error-title">é”™è¯¯ä¿¡æ¯:</view>
            <view class="error-content">{{testResult.error}}</view>
          </view>
        </view>
      </view>
    </view>
  </view>
</view>