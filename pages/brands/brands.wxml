<!--pages/brands/brands.wxml-->
<view class="container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="header">
    <view class="header-content">
      <view class="title">å“ç‰Œç®¡ç†</view>
      <view class="header-actions">
        <view class="action-btn" bindtap="toggleSearchBar">
          <text class="icon">ğŸ”</text>
        </view>
        <view class="action-btn" bindtap="toggleFilterPanel">
          <text class="icon">ğŸ”§</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æœç´¢æ  -->
  <view class="search-bar {{showSearchBar ? 'show' : ''}}">
    <view class="search-input-wrapper">
      <input 
        class="search-input" 
        placeholder="æœç´¢å“ç‰Œåç§°æˆ–ç‰¹è‰²..." 
        value="{{searchKeyword}}"
        bindinput="onSearchInput"
        bindconfirm="onSearchConfirm"
      />
      <view class="search-btn" bindtap="onSearchConfirm">
        <text class="icon">ğŸ”</text>
      </view>
    </view>
    
    <!-- çƒ­é—¨æœç´¢ -->
    <view class="search-suggestions" wx:if="{{!searchKeyword}}">
      <view class="suggestion-section">
        <view class="suggestion-title">çƒ­é—¨æœç´¢</view>
        <view class="suggestion-tags">
          <view 
            class="suggestion-tag" 
            wx:for="{{hotSearches}}" 
            wx:key="*this"
            data-keyword="{{item}}"
            bindtap="onHotSearchTap"
          >
            {{item}}
          </view>
        </view>
      </view>
      
      <!-- æœç´¢å†å² -->
      <view class="suggestion-section" wx:if="{{searchHistory.length > 0}}">
        <view class="suggestion-header">
          <view class="suggestion-title">æœç´¢å†å²</view>
          <view class="clear-history" bindtap="clearSearchHistory">æ¸…ç©º</view>
        </view>
        <view class="suggestion-list">
          <view 
            class="suggestion-item" 
            wx:for="{{searchHistory}}" 
            wx:key="*this"
            data-keyword="{{item}}"
            bindtap="onHistoryItemTap"
          >
            <text class="icon">ğŸ•</text>
            <text class="text">{{item}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- ç»Ÿè®¡ä¿¡æ¯ -->
  <view class="stats-section">
    <view class="stats-card">
      <view class="stat-item">
        <view class="stat-number">{{stats.totalBrands}}</view>
        <view class="stat-label">æ€»å“ç‰Œæ•°</view>
      </view>
      <view class="stat-item">
        <view class="stat-number">{{stats.skincareCount}}</view>
        <view class="stat-label">æŠ¤è‚¤å“ç‰Œ</view>
      </view>
      <view class="stat-item">
        <view class="stat-number">{{stats.makeupCount}}</view>
        <view class="stat-label">å½©å¦†å“ç‰Œ</view>
      </view>
      <view class="stat-item">
        <view class="stat-number">{{stats.fragranceCount}}</view>
        <view class="stat-label">é¦™æ°´å“ç‰Œ</view>
      </view>
    </view>
  </view>

  <!-- å·¥å…·æ  -->
  <view class="toolbar">
    <view class="sort-section">
      <text class="sort-label">æ’åºï¼š</text>
      <picker 
        class="sort-picker" 
        range="{{sortOptions}}" 
        range-key="label"
        bindchange="onSortChange"
      >
        <view class="sort-value">
          {{sortOptions[currentSort] || sortOptions[0].label}}
          <text class="arrow">â–¼</text>
        </view>
      </picker>
    </view>
    <view class="result-count">
      å…± {{filteredBrands.length}} ä¸ªå“ç‰Œ
    </view>
  </view>

  <!-- å“ç‰Œåˆ—è¡¨ -->
  <view class="content">
    <!-- åŠ è½½çŠ¶æ€ -->
    <view class="loading" wx:if="{{loading && brandList.length === 0}}">
      <view class="loading-spinner"></view>
      <view class="loading-text">åŠ è½½ä¸­...</view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty" wx:elif="{{!loading && filteredBrands.length === 0}}">
      <view class="empty-icon">ğŸ¢</view>
      <view class="empty-text">æš‚æ— å“ç‰Œæ•°æ®</view>
      <view class="empty-desc">è¯·å°è¯•è°ƒæ•´ç­›é€‰æ¡ä»¶</view>
    </view>

    <!-- å“ç‰Œç½‘æ ¼ -->
    <view class="brand-grid" wx:else>
      <view 
        class="brand-item" 
        wx:for="{{filteredBrands}}" 
        wx:key="id"
        data-brand="{{item}}"
        bindtap="onBrandTap"
      >
        <view class="brand-header">
          <image class="brand-logo" src="{{item.logo}}" mode="aspectFit" />
          <view class="brand-country">{{item.country === 'japan' ? 'ğŸ‡¯ğŸ‡µ' : item.country === 'korea' ? 'ğŸ‡°ğŸ‡·' : item.country === 'usa' ? 'ğŸ‡ºğŸ‡¸' : item.country === 'france' ? 'ğŸ‡«ğŸ‡·' : item.country === 'germany' ? 'ğŸ‡©ğŸ‡ª' : 'ğŸ‡¨ğŸ‡³'}}</view>
        </view>
        
        <view class="brand-info">
          <view class="brand-name">{{item.name}}</view>
          <view class="brand-english">{{item.englishName}}</view>
          <view class="brand-founded">åˆ›ç«‹äº {{item.founded}}</view>
        </view>
        
        <view class="brand-stats">
          <view class="stat">
            <text class="icon">â­</text>
            <text class="value">{{item.rating}}</text>
          </view>
          <view class="stat">
            <text class="icon">ğŸ“¦</text>
            <text class="value">{{item.productCount}}</text>
          </view>
          <view class="stat">
            <text class="icon">â¤ï¸</text>
            <text class="value">{{item.followCount}}</text>
          </view>
        </view>
        
        <view class="brand-tags">
          <view 
            class="tag" 
            wx:for="{{item.specialties}}" 
            wx:for-item="specialty"
            wx:key="*this"
          >
            {{specialty}}
          </view>
        </view>
        
        <view class="brand-actions">
          <view 
            class="action-btn follow-btn {{isFollowed(item.id) ? 'followed' : ''}}"
            data-brand="{{item}}"
            bindtap="toggleFollow"
            catchtap="true"
          >
            <text class="icon">{{isFollowed(item.id) ? 'â¤ï¸' : 'ğŸ¤'}}</text>
            <text class="text">{{isFollowed(item.id) ? 'å·²å…³æ³¨' : 'å…³æ³¨'}}</text>
          </view>
          <view 
            class="action-btn products-btn"
            data-brand="{{item}}"
            bindtap="viewBrandProducts"
            catchtap="true"
          >
            <text class="icon">ğŸ“¦</text>
            <text class="text">äº§å“</text>
          </view>
        </view>
      </view>
    </view>

    <!-- åŠ è½½æ›´å¤š -->
    <view class="load-more" wx:if="{{loading && brandList.length > 0}}">
      <view class="loading-spinner small"></view>
      <text class="loading-text">åŠ è½½æ›´å¤š...</text>
    </view>
  </view>

  <!-- ç­›é€‰é¢æ¿ -->
  <view class="filter-panel {{showFilterPanel ? 'show' : ''}}" wx:if="{{showFilterPanel}}">
    <view class="filter-mask" bindtap="onFilterMaskTap"></view>
    <view class="filter-content">
      <view class="filter-header">
        <view class="filter-title">ç­›é€‰æ¡ä»¶</view>
        <view class="filter-close" bindtap="toggleFilterPanel">âœ•</view>
      </view>
      
      <scroll-view class="filter-body" scroll-y>
        <!-- å“ç‰Œå›½å®¶ -->
        <view class="filter-section">
          <view class="filter-section-title">å“ç‰Œå›½å®¶</view>
          <view class="filter-options">
            <view 
              class="filter-option {{filterOptions.country === item.value ? 'active' : ''}}"
              wx:for="{{countries}}" 
              wx:key="value"
              data-value="{{item.value}}"
              bindtap="onCountryTap"
            >
              <text class="option-icon">{{item.icon}}</text>
              <text class="option-label">{{item.label}}</text>
            </view>
          </view>
        </view>
        
        <!-- ä»·æ ¼åŒºé—´ -->
        <view class="filter-section">
          <view class="filter-section-title">ä»·æ ¼åŒºé—´</view>
          <view class="filter-options">
            <view 
              class="filter-option {{filterOptions.priceRange === item.value ? 'active' : ''}}"
              wx:for="{{priceRanges}}" 
              wx:key="value"
              data-value="{{item.value}}"
              bindtap="onPriceRangeTap"
            >
              <text class="option-icon">{{item.icon}}</text>
              <text class="option-label">{{item.label}}</text>
            </view>
          </view>
        </view>
        
        <!-- å“ç‰Œç±»åˆ« -->
        <view class="filter-section">
          <view class="filter-section-title">å“ç‰Œç±»åˆ«</view>
          <view class="filter-options">
            <view 
              class="filter-option {{filterOptions.category === item.value ? 'active' : ''}}"
              wx:for="{{categories}}" 
              wx:key="value"
              data-value="{{item.value}}"
              bindtap="onCategoryTap"
            >
              <text class="option-icon">{{item.icon}}</text>
              <text class="option-label">{{item.label}}</text>
            </view>
          </view>
        </view>
        
        <!-- çƒ­åº¦é€‰é¡¹ -->
        <view class="filter-section">
          <view class="filter-section-title">å“ç‰Œçƒ­åº¦</view>
          <view class="filter-options">
            <view 
              class="filter-option {{filterOptions.popularity === item.value ? 'active' : ''}}"
              wx:for="{{popularityOptions}}" 
              wx:key="value"
              data-value="{{item.value}}"
              bindtap="onPopularityTap"
            >
              <text class="option-icon">{{item.icon}}</text>
              <text class="option-label">{{item.label}}</text>
            </view>
          </view>
        </view>
      </scroll-view>
      
      <view class="filter-footer">
        <view class="filter-btn reset-btn" bindtap="resetFilters">é‡ç½®</view>
        <view class="filter-btn confirm-btn" bindtap="confirmFilters">ç¡®å®š</view>
      </view>
    </view>
  </view>

  <!-- å“ç‰Œè¯¦æƒ…å¼¹çª— -->
  <view class="brand-detail-modal {{showBrandDetail ? 'show' : ''}}" wx:if="{{showBrandDetail && selectedBrand}}">
    <view class="modal-mask" bindtap="onDetailMaskTap"></view>
    <view class="modal-content">
      <view class="modal-header">
        <view class="brand-header-info">
          <image class="brand-logo-large" src="{{selectedBrand.logo}}" mode="aspectFit" />
          <view class="brand-basic-info">
            <view class="brand-name-large">{{selectedBrand.name}}</view>
            <view class="brand-english-large">{{selectedBrand.englishName}}</view>
            <view class="brand-meta">
              <text class="country">{{selectedBrand.country === 'japan' ? 'ğŸ‡¯ğŸ‡µ æ—¥æœ¬' : selectedBrand.country === 'korea' ? 'ğŸ‡°ğŸ‡· éŸ©å›½' : selectedBrand.country === 'usa' ? 'ğŸ‡ºğŸ‡¸ ç¾å›½' : selectedBrand.country === 'france' ? 'ğŸ‡«ğŸ‡· æ³•å›½' : selectedBrand.country === 'germany' ? 'ğŸ‡©ğŸ‡ª å¾·å›½' : 'ğŸ‡¨ğŸ‡³ ä¸­å›½'}}</text>
              <text class="founded">åˆ›ç«‹äº {{selectedBrand.founded}}</text>
            </view>
          </view>
        </view>
        <view class="modal-close" bindtap="closeBrandDetail">âœ•</view>
      </view>
      
      <scroll-view class="modal-body" scroll-y>
        <!-- å“ç‰Œæè¿° -->
        <view class="detail-section">
          <view class="section-title">å“ç‰Œä»‹ç»</view>
          <view class="brand-description">{{selectedBrand.description}}</view>
        </view>
        
        <!-- å“ç‰Œç»Ÿè®¡ -->
        <view class="detail-section">
          <view class="section-title">å“ç‰Œæ•°æ®</view>
          <view class="brand-stats-detail">
            <view class="stat-item">
              <view class="stat-icon">â­</view>
              <view class="stat-info">
                <view class="stat-value">{{selectedBrand.rating}}</view>
                <view class="stat-label">ç”¨æˆ·è¯„åˆ†</view>
              </view>
            </view>
            <view class="stat-item">
              <view class="stat-icon">ğŸ“¦</view>
              <view class="stat-info">
                <view class="stat-value">{{selectedBrand.productCount}}</view>
                <view class="stat-label">äº§å“æ•°é‡</view>
              </view>
            </view>
            <view class="stat-item">
              <view class="stat-icon">â¤ï¸</view>
              <view class="stat-info">
                <view class="stat-value">{{selectedBrand.followCount}}</view>
                <view class="stat-label">å…³æ³¨äººæ•°</view>
              </view>
            </view>
          </view>
        </view>
        
        <!-- å“ç‰Œç‰¹è‰² -->
        <view class="detail-section">
          <view class="section-title">å“ç‰Œç‰¹è‰²</view>
          <view class="specialties-list">
            <view 
              class="specialty-item" 
              wx:for="{{selectedBrand.specialties}}" 
              wx:key="*this"
            >
              <text class="specialty-icon">âœ¨</text>
              <text class="specialty-text">{{item}}</text>
            </view>
          </view>
        </view>
        
        <!-- çƒ­é—¨äº§å“ -->
        <view class="detail-section">
          <view class="section-title">çƒ­é—¨äº§å“</view>
          <view class="hot-products">
            <view 
              class="hot-product" 
              wx:for="{{selectedBrand.hotProducts}}" 
              wx:key="*this"
            >
              <text class="product-icon">ğŸ”¥</text>
              <text class="product-name">{{item}}</text>
            </view>
          </view>
        </view>
      </scroll-view>
      
      <view class="modal-footer">
        <view 
          class="modal-btn follow-btn {{isFollowed(selectedBrand.id) ? 'followed' : ''}}"
          data-brand="{{selectedBrand}}"
          bindtap="toggleFollow"
        >
          <text class="btn-icon">{{isFollowed(selectedBrand.id) ? 'â¤ï¸' : 'ğŸ¤'}}</text>
          <text class="btn-text">{{isFollowed(selectedBrand.id) ? 'å·²å…³æ³¨' : 'å…³æ³¨å“ç‰Œ'}}</text>
        </view>
        <view 
          class="modal-btn products-btn"
          data-brand="{{selectedBrand}}"
          bindtap="goToProducts"
        >
          <text class="btn-icon">ğŸ“¦</text>
          <text class="btn-text">æŸ¥çœ‹äº§å“</text>
        </view>
        <view 
          class="modal-btn share-btn"
          data-brand="{{selectedBrand}}"
          bindtap="onShareBrand"
        >
          <text class="btn-icon">ğŸ“¤</text>
          <text class="btn-text">åˆ†äº«</text>
        </view>
      </view>
    </view>
  </view>

  <!-- å“ç‰Œäº§å“å¼¹çª— -->
  <view class="brand-products-modal {{showBrandProducts ? 'show' : ''}}" wx:if="{{showBrandProducts && selectedBrandForProducts}}">
    <view class="modal-mask" bindtap="closeBrandProducts"></view>
    <view class="modal-content">
      <view class="modal-header">
        <view class="modal-title">{{selectedBrandForProducts.name}} äº§å“</view>
        <view class="modal-close" bindtap="closeBrandProducts">âœ•</view>
      </view>
      
      <scroll-view class="modal-body" scroll-y>
        <view class="products-list">
          <view 
            class="product-item" 
            wx:for="{{brandProducts}}" 
            wx:key="id"
          >
            <image class="product-image" src="{{item.image}}" mode="aspectFit" />
            <view class="product-info">
              <view class="product-name">{{item.name}}</view>
              <view class="product-category">{{item.category}}</view>
              <view class="product-meta">
                <view class="product-price">Â¥{{item.price}}</view>
                <view class="product-rating">
                  <text class="rating-icon">â­</text>
                  <text class="rating-value">{{item.rating}}</text>
                </view>
              </view>
            </view>
          </view>
        </view>
      </scroll-view>
    </view>
  </view>
</view>