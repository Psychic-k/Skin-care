<!--äº§å“çŸ¥è¯†åº“é¡µé¢-->
<view class="container">
  <!-- æœç´¢æ  -->
  <view class="search-section">
    <view class="search-bar">
      <input 
        class="search-input" 
        placeholder="æœç´¢äº§å“ã€æˆåˆ†ã€å“ç‰Œ..." 
        value="{{searchKeyword}}"
        bindinput="onSearchInput"
        bindconfirm="onSearch"
      />
      <view class="search-btn" bindtap="onSearch">
        <text class="iconfont icon-search">ğŸ”</text>
      </view>
    </view>
    
    <!-- æœç´¢å†å²å’Œçƒ­é—¨æœç´¢ -->
    <view class="search-suggestions" wx:if="{{showSuggestions}}">
      <view class="suggestion-section" wx:if="{{searchHistory.length > 0}}">
        <view class="suggestion-title">æœç´¢å†å²</view>
        <view class="suggestion-tags">
          <text 
            class="suggestion-tag" 
            wx:for="{{searchHistory}}" 
            wx:key="index"
            bindtap="onSelectSuggestion"
            data-keyword="{{item}}"
          >{{item}}</text>
        </view>
      </view>
      
      <view class="suggestion-section">
        <view class="suggestion-title">çƒ­é—¨æœç´¢</view>
        <view class="suggestion-tags">
          <text 
            class="suggestion-tag hot" 
            wx:for="{{hotSearches}}" 
            wx:key="index"
            bindtap="onSelectSuggestion"
            data-keyword="{{item}}"
          >{{item}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æ ‡ç­¾é¡µå¯¼èˆª -->
  <view class="tabs">
    <view 
      class="tab-item {{currentTab === index ? 'active' : ''}}"
      wx:for="{{tabs}}" 
      wx:key="index"
      bindtap="onTabChange"
      data-index="{{index}}"
    >
      {{item.name}}
      <view class="tab-indicator" wx:if="{{currentTab === index}}"></view>
    </view>
  </view>

  <!-- ç­›é€‰æ  -->
  <view class="filter-section" wx:if="{{currentTab !== 3}}">
    <scroll-view class="filter-scroll" scroll-x="true">
      <view class="filter-item" bindtap="onShowFilter">
        <text>ç­›é€‰</text>
        <text class="filter-icon">âš™ï¸</text>
      </view>
      <view class="filter-item" wx:if="{{currentTab === 0}}">
        <text>åˆ†ç±»</text>
        <text class="filter-icon">ğŸ“‹</text>
      </view>
      <view class="filter-item" wx:if="{{currentTab === 0}}">
        <text>è‚Œè‚¤ç±»å‹</text>
        <text class="filter-icon">ğŸ‘¤</text>
      </view>
      <view class="filter-item" wx:if="{{currentTab === 0}}">
        <text>ä»·æ ¼</text>
        <text class="filter-icon">ğŸ’°</text>
      </view>
    </scroll-view>
  </view>

  <!-- å†…å®¹åŒºåŸŸ -->
  <scroll-view class="content-scroll" scroll-y="true" bindscrolltolower="onLoadMore">
    <!-- äº§å“åˆ—è¡¨ -->
    <view class="product-list" wx:if="{{currentTab === 0}}">
      <view 
        class="product-card"
        wx:for="{{filteredProducts}}" 
        wx:key="id"
        bindtap="onProductDetail"
        data-product="{{item}}"
      >
        <image class="product-image" src="{{item.image}}" mode="aspectFill" />
        <view class="product-info">
          <view class="product-name">{{item.name}}</view>
          <view class="product-brand">{{item.brand}}</view>
          <view class="product-price">Â¥{{item.price}}</view>
          <view class="product-tags">
            <text class="product-tag" wx:for="{{item.tags}}" wx:key="index" wx:for-item="tag">{{tag}}</text>
          </view>
        </view>
        <view class="product-actions">
          <view 
            class="action-btn favorite {{item.isFavorite ? 'active' : ''}}"
            bindtap="onToggleFavorite"
            data-id="{{item.id}}"
            catchtap="true"
          >
            <text class="action-icon">{{item.isFavorite ? 'â¤ï¸' : 'ğŸ¤'}}</text>
          </view>
          <view 
            class="action-btn share"
            bindtap="onShare"
            data-product="{{item}}"
            catchtap="true"
          >
            <text class="action-icon">ğŸ“¤</text>
          </view>
        </view>
      </view>
    </view>

    <!-- æˆåˆ†åˆ—è¡¨ -->
    <view class="ingredient-list" wx:if="{{currentTab === 1}}">
      <view 
        class="ingredient-card"
        wx:for="{{filteredIngredients}}" 
        wx:key="id"
        bindtap="onIngredientDetail"
        data-ingredient="{{item}}"
      >
        <view class="ingredient-header">
          <view class="ingredient-name">{{item.name}}</view>
          <view class="ingredient-safety {{item.safetyLevel}}">
            <text class="safety-text">{{item.safetyText}}</text>
          </view>
        </view>
        <view class="ingredient-description">{{item.description}}</view>
        <view class="ingredient-effects">
          <text class="effect-tag" wx:for="{{item.effects}}" wx:key="index" wx:for-item="effect">{{effect}}</text>
        </view>
      </view>
    </view>

    <!-- å“ç‰Œåˆ—è¡¨ -->
    <view class="brand-list" wx:if="{{currentTab === 2}}">
      <view 
        class="brand-card"
        wx:for="{{filteredBrands}}" 
        wx:key="id"
        bindtap="onBrandDetail"
        data-brand="{{item}}"
      >
        <image class="brand-logo" src="{{item.logo}}" mode="aspectFit" />
        <view class="brand-info">
          <view class="brand-name">{{item.name}}</view>
          <view class="brand-description">{{item.description}}</view>
          <view class="brand-stats">
            <text class="stat-item">äº§å“ {{item.productCount}}</text>
            <text class="stat-item">å…³æ³¨ {{item.followCount}}</text>
          </view>
        </view>
        <view class="brand-follow">
          <view 
            class="follow-btn {{item.isFollowed ? 'followed' : ''}}"
            bindtap="onToggleFollow"
            data-id="{{item.id}}"
            catchtap="true"
          >
            {{item.isFollowed ? 'å·²å…³æ³¨' : 'å…³æ³¨'}}
          </view>
        </view>
      </view>
    </view>

    <!-- æ”¶è—åˆ—è¡¨ -->
    <view class="favorite-list" wx:if="{{currentTab === 3}}">
      <view class="favorite-tabs">
        <view 
          class="favorite-tab {{favoriteTab === index ? 'active' : ''}}"
          wx:for="{{favoriteTabs}}" 
          wx:key="index"
          bindtap="onFavoriteTabChange"
          data-index="{{index}}"
        >
          {{item}}
        </view>
      </view>
      
      <view class="favorite-content">
        <!-- æ”¶è—çš„äº§å“ -->
        <view class="favorite-products" wx:if="{{favoriteTab === 0}}">
          <view 
            class="product-card small"
            wx:for="{{favoriteProducts}}" 
            wx:key="id"
            bindtap="onProductDetail"
            data-product="{{item}}"
          >
            <image class="product-image" src="{{item.image}}" mode="aspectFill" />
            <view class="product-info">
              <view class="product-name">{{item.name}}</view>
              <view class="product-price">Â¥{{item.price}}</view>
            </view>
          </view>
        </view>
        
        <!-- æ”¶è—çš„æˆåˆ† -->
        <view class="favorite-ingredients" wx:if="{{favoriteTab === 1}}">
          <view 
            class="ingredient-card small"
            wx:for="{{favoriteIngredients}}" 
            wx:key="id"
            bindtap="onIngredientDetail"
            data-ingredient="{{item}}"
          >
            <view class="ingredient-name">{{item.name}}</view>
            <view class="ingredient-description">{{item.description}}</view>
          </view>
        </view>
        
        <!-- å…³æ³¨çš„å“ç‰Œ -->
        <view class="favorite-brands" wx:if="{{favoriteTab === 2}}">
          <view 
            class="brand-card small"
            wx:for="{{favoriteBrands}}" 
            wx:key="id"
            bindtap="onBrandDetail"
            data-brand="{{item}}"
          >
            <image class="brand-logo" src="{{item.logo}}" mode="aspectFit" />
            <view class="brand-name">{{item.name}}</view>
          </view>
        </view>
      </view>
    </view>

    <!-- åŠ è½½æ›´å¤š -->
    <view class="load-more" wx:if="{{hasMore}}">
      <text class="load-text">{{loading ? 'åŠ è½½ä¸­...' : 'ä¸Šæ‹‰åŠ è½½æ›´å¤š'}}</text>
    </view>
    
    <!-- æ²¡æœ‰æ›´å¤šæ•°æ® -->
    <view class="no-more" wx:if="{{!hasMore && (filteredProducts.length > 0 || filteredIngredients.length > 0 || filteredBrands.length > 0)}}">
      <text class="no-more-text">æ²¡æœ‰æ›´å¤šæ•°æ®äº†</text>
    </view>
    
    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{isEmpty}}">
      <text class="empty-icon">ğŸ“¦</text>
      <text class="empty-text">æš‚æ— ç›¸å…³å†…å®¹</text>
      <text class="empty-tip">è¯•è¯•å…¶ä»–æœç´¢å…³é”®è¯</text>
    </view>
  </scroll-view>
</view>

<!-- ç­›é€‰å¼¹çª— -->
<view class="filter-modal" wx:if="{{showFilterModal}}" bindtap="onHideFilter">
  <view class="filter-content" catchtap="true">
    <view class="filter-header">
      <text class="filter-title">ç­›é€‰æ¡ä»¶</text>
      <text class="filter-close" bindtap="onHideFilter">âœ•</text>
    </view>
    
    <scroll-view class="filter-body" scroll-y="true">
      <!-- åˆ†ç±»ç­›é€‰ -->
      <view class="filter-group" wx:if="{{currentTab === 0}}">
        <view class="filter-group-title">äº§å“åˆ†ç±»</view>
        <view class="filter-options">
          <view 
            class="filter-option {{item.selected ? 'selected' : ''}}"
            wx:for="{{categoryOptions}}" 
            wx:key="id"
            bindtap="onFilterOptionChange"
            data-type="category"
            data-id="{{item.id}}"
          >
            {{item.name}}
          </view>
        </view>
      </view>
      
      <!-- è‚Œè‚¤ç±»å‹ç­›é€‰ -->
      <view class="filter-group" wx:if="{{currentTab === 0}}">
        <view class="filter-group-title">é€‚ç”¨è‚Œè‚¤</view>
        <view class="filter-options">
          <view 
            class="filter-option {{item.selected ? 'selected' : ''}}"
            wx:for="{{skinTypeOptions}}" 
            wx:key="id"
            bindtap="onFilterOptionChange"
            data-type="skinType"
            data-id="{{item.id}}"
          >
            {{item.name}}
          </view>
        </view>
      </view>
      
      <!-- ä»·æ ¼ç­›é€‰ -->
      <view class="filter-group" wx:if="{{currentTab === 0}}">
        <view class="filter-group-title">ä»·æ ¼åŒºé—´</view>
        <view class="filter-options">
          <view 
            class="filter-option {{item.selected ? 'selected' : ''}}"
            wx:for="{{priceOptions}}" 
            wx:key="id"
            bindtap="onFilterOptionChange"
            data-type="price"
            data-id="{{item.id}}"
          >
            {{item.name}}
          </view>
        </view>
      </view>
    </scroll-view>
    
    <view class="filter-footer">
      <view class="filter-btn reset" bindtap="onResetFilter">é‡ç½®</view>
      <view class="filter-btn confirm" bindtap="onConfirmFilter">ç¡®å®š</view>
    </view>
  </view>
</view>