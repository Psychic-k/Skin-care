<!--ä½“éªŒå®˜ä¸­å¿ƒé¡µé¢-->
<view class="container">
  <!-- å¤´éƒ¨ä¿¡æ¯å¡ç‰‡ -->
  <view class="header-card">
    <view class="user-info">
      <image class="avatar" src="{{userInfo.avatarUrl || '/images/default-avatar.png'}}" mode="aspectFill" />
      <view class="user-details">
        <view class="username">{{userInfo.nickName || 'ä½“éªŒå®˜'}}</view>
        <view class="level-badge">
          <text class="level-icon">â­</text>
          <text class="level-text">{{getLevelName(expertLevel)}}</text>
        </view>
      </view>
      <view class="share-btn" bindtap="onShareAchievement">
        <text class="share-icon">ğŸ“¤</text>
      </view>
    </view>
    
    <!-- ç§¯åˆ†è¿›åº¦ -->
    <view class="points-progress">
      <view class="progress-header">
        <view class="current-points">
          <text class="points-number">{{currentPoints}}</text>
          <text class="points-label">å½“å‰ç§¯åˆ†</text>
        </view>
        <view class="next-level">
          <text class="next-points">{{nextLevelPoints}}</text>
          <text class="next-label">ä¸‹çº§æ‰€éœ€</text>
        </view>
      </view>
      <view class="progress-bar">
        <view class="progress-fill" style="width: {{progressPercent}}%"></view>
      </view>
      <view class="progress-actions">
        <view class="action-btn" bindtap="onPointsExchange">
          <text class="action-icon">ğŸ</text>
          <text class="action-text">ç§¯åˆ†å…‘æ¢</text>
        </view>
        <view class="action-btn" bindtap="onPointsRule">
          <text class="action-icon">ğŸ“–</text>
          <text class="action-text">ç§¯åˆ†è§„åˆ™</text>
        </view>
      </view>
    </view>
    
    <!-- ç»Ÿè®¡æ•°æ® -->
    <view class="stats-grid">
      <view class="stat-item">
        <text class="stat-number">{{stats.completedTasks}}</text>
        <text class="stat-label">å®Œæˆä»»åŠ¡</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{stats.totalReports}}</text>
        <text class="stat-label">æäº¤æŠ¥å‘Š</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{stats.totalPoints}}</text>
        <text class="stat-label">ç´¯è®¡ç§¯åˆ†</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{stats.ranking}}</text>
        <text class="stat-label">å½“å‰æ’å</text>
      </view>
    </view>
  </view>

  <!-- æ ‡ç­¾é¡µå¯¼èˆª -->
  <view class="tabs">
    <view 
      class="tab-item {{currentTab === index ? 'active' : ''}}"
      wx:for="{{tabs}}" 
      wx:key="index"
      bindtap="onTabChange"
      data-index="{{index}}"
    >
      <text class="tab-icon">{{item.icon}}</text>
      <text class="tab-name">{{item.name}}</text>
      <view class="tab-indicator" wx:if="{{currentTab === index}}"></view>
    </view>
  </view>

  <!-- å†…å®¹åŒºåŸŸ -->
  <scroll-view class="content-scroll" scroll-y="true" bindscrolltolower="loadMore">
    
    <!-- ä»»åŠ¡ä¸­å¿ƒ -->
    <view class="task-center" wx:if="{{currentTab === 0}}">
      <!-- ä»»åŠ¡æ ‡ç­¾é¡µ -->
      <view class="task-tabs">
        <view 
          class="task-tab {{currentTaskTab === index ? 'active' : ''}}"
          wx:for="{{taskTabs}}" 
          wx:key="index"
          bindtap="onTaskTabChange"
          data-index="{{index}}"
        >
          {{item}}
        </view>
      </view>
      
      <!-- ä»»åŠ¡åˆ—è¡¨ -->
      <view class="task-list">
        <view 
          class="task-card"
          wx:for="{{tasks}}" 
          wx:key="id"
          bindtap="onTaskDetail"
          data-task="{{item}}"
        >
          <view class="task-header">
            <view class="task-title">{{item.title}}</view>
            <view class="task-status {{getTaskStatusClass(item.status)}}">
              {{getTaskStatusText(item.status)}}
            </view>
          </view>
          
          <view class="task-description">{{item.description}}</view>
          
          <view class="task-info">
            <view class="task-points">
              <text class="points-icon">ğŸ’</text>
              <text class="points-text">{{item.points}}ç§¯åˆ†</text>
            </view>
            <view class="task-deadline">
              <text class="deadline-icon">â°</text>
              <text class="deadline-text">{{formatDate(item.deadline)}}</text>
            </view>
          </view>
          
          <view class="task-actions" wx:if="{{item.status === 'pending' || item.status === 'in_progress'}}">
            <view 
              class="task-btn accept"
              wx:if="{{item.status === 'pending'}}"
              bindtap="onAcceptTask"
              data-task="{{item}}"
              catchtap="true"
            >
              æ¥å—ä»»åŠ¡
            </view>
            <view 
              class="task-btn submit"
              wx:if="{{item.status === 'in_progress'}}"
              bindtap="onSubmitTask"
              data-task="{{item}}"
              catchtap="true"
            >
              æäº¤ä»»åŠ¡
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- ç§¯åˆ†è®°å½• -->
    <view class="points-records" wx:if="{{currentTab === 1}}">
      <view 
        class="record-card"
        wx:for="{{pointRecords}}" 
        wx:key="id"
      >
        <view class="record-info">
          <view class="record-title">{{item.title}}</view>
          <view class="record-time">{{formatDate(item.createTime)}}</view>
        </view>
        <view class="record-points {{getPointChangeClass(item.points)}}">
          {{formatPointChange(item.points, item.type)}}
        </view>
      </view>
      
      <!-- åŠ è½½æ›´å¤š -->
      <view class="load-more" wx:if="{{hasMore}}">
        <text class="load-text">{{loading ? 'åŠ è½½ä¸­...' : 'ä¸Šæ‹‰åŠ è½½æ›´å¤š'}}</text>
      </view>
    </view>

    <!-- æ’è¡Œæ¦œ -->
    <view class="rankings" wx:if="{{currentTab === 2}}">
      <view 
        class="ranking-card"
        wx:for="{{rankings}}" 
        wx:key="id"
      >
        <view class="ranking-number {{index < 3 ? 'top-three' : ''}}">
          <text wx:if="{{index === 0}}">ğŸ¥‡</text>
          <text wx:elif="{{index === 1}}">ğŸ¥ˆ</text>
          <text wx:elif="{{index === 2}}">ğŸ¥‰</text>
          <text wx:else>{{index + 1}}</text>
        </view>
        
        <image class="ranking-avatar" src="{{item.avatarUrl}}" mode="aspectFill" />
        
        <view class="ranking-info">
          <view class="ranking-name">{{item.nickName}}</view>
          <view class="ranking-level">{{getLevelName(item.level)}}</view>
        </view>
        
        <view class="ranking-points">
          <text class="points-number">{{item.points}}</text>
          <text class="points-label">ç§¯åˆ†</text>
        </view>
      </view>
    </view>

    <!-- æˆ‘çš„æŠ¥å‘Š -->
    <view class="my-reports" wx:if="{{currentTab === 3}}">
      <view 
        class="report-card"
        wx:for="{{reports}}" 
        wx:key="id"
        bindtap="onReportDetail"
        data-report="{{item}}"
      >
        <view class="report-header">
          <view class="report-title">{{item.title}}</view>
          <view class="report-status {{item.status}}">
            {{item.statusText}}
          </view>
        </view>
        
        <view class="report-content">
          <view class="report-product">
            <image class="product-image" src="{{item.productImage}}" mode="aspectFill" />
            <view class="product-info">
              <view class="product-name">{{item.productName}}</view>
              <view class="product-brand">{{item.productBrand}}</view>
            </view>
          </view>
          
          <view class="report-summary">{{item.summary}}</view>
        </view>
        
        <view class="report-footer">
          <view class="report-time">{{formatDate(item.createTime)}}</view>
          <view class="report-score" wx:if="{{item.score}}">
            <text class="score-label">è¯„åˆ†:</text>
            <text class="score-value">{{item.score}}/10</text>
          </view>
        </view>
      </view>
      
      <!-- åŠ è½½æ›´å¤š -->
      <view class="load-more" wx:if="{{hasMore}}">
        <text class="load-text">{{loading ? 'åŠ è½½ä¸­...' : 'ä¸Šæ‹‰åŠ è½½æ›´å¤š'}}</text>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{isEmpty}}">
      <text class="empty-icon">ğŸ“‹</text>
      <text class="empty-text">æš‚æ— ç›¸å…³å†…å®¹</text>
      <text class="empty-tip">å®Œæˆæ›´å¤šä»»åŠ¡è·å¾—ç§¯åˆ†å¥–åŠ±</text>
    </view>
  </scroll-view>
</view>